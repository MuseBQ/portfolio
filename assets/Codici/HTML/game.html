<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hack 'n' Slash Game</title>
    <style>
        canvas {
            display: block;
            border: 2px solid white;
            background-color: black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = 800;
        canvas.height = 600;

        const gravity = 0.5;
        const backgroundImage = new Image();
        backgroundImage.src = 'background.png';
        const groundImage = new Image();
        groundImage.src = 'ground.png';

        interface Vector {
            x: number;
            y: number;
        }

        class Entity {
            x: number;
            y: number;
            size: number;
            image: HTMLImageElement;
            velocity: Vector;

            constructor(x: number, y: number, size: number, imageSrc: string) {
                this.x = x;
                this.y = y;
                this.size = size;
                this.image = new Image();
                this.image.src = imageSrc;
                this.velocity = { x: 0, y: 0 };
            }

            draw(): void {
                ctx.drawImage(this.image, this.x - this.size / 2, this.y - this.size / 2, this.size * 2, this.size * 2);
            }
        }

        class Player extends Entity {
            health: number;
            speed: number;

            constructor(x: number, y: number) {
                super(x, y, 30, 'player.png');
                this.health = 100;
                this.speed = 5;
            }

            move(direction: string): void {
                switch (direction) {
                    case 'up':
                        if (this.y + this.size >= canvas.height - 50) {
                            this.velocity.y = -10;
                        }
                        break;
                    case 'left':
                        this.velocity.x = -this.speed;
                        break;
                    case 'right':
                        this.velocity.x = this.speed;
                        break;
                }
            }

            stop(): void {
                this.velocity.x *= 0.8;
            }

            attack(enemy: Enemy): void {
                enemy.takeDamage(20);
            }

            update(): void {
                this.x += this.velocity.x;
                this.y += this.velocity.y;

                if (this.y + this.size < canvas.height - 50) {
                    this.velocity.y += gravity;
                } else {
                    this.velocity.y = 0;
                    this.y = canvas.height - 50 - this.size;
                }
            }
        }

        class Enemy extends Entity {
            health: number;
            speed: number;

            constructor(x: number, y: number) {
                super(x, y, 25, 'enemy.png');
                this.health = 50;
                this.speed = 2;
                this.velocity.x = Math.random() > 0.5 ? 1 : -1;
            }

            takeDamage(damage: number): void {
                this.health -= damage;
                if (this.health <= 0) {
                    this.x = -100;
                }
            }

            update(player: Player): void {
                this.velocity.x = this.x < player.x ? this.speed : -this.speed;
                this.x += this.velocity.x;
            }
        }

        const player = new Player(50, canvas.height - 80);
        const enemies = [new Enemy(300, canvas.height - 80), new Enemy(600, canvas.height - 80)];

        document.addEventListener('keydown', (event: KeyboardEvent) => {
            switch (event.key) {
                case 'ArrowUp':
                    player.move('up');
                    break;
                case 'ArrowLeft':
                    player.move('left');
                    break;
                case 'ArrowRight':
                    player.move('right');
                    break;
                case ' ':
                    enemies.forEach(enemy => {
                        if (Math.abs(player.x - enemy.x) < 40 && Math.abs(player.y - enemy.y) < 40) {
                            player.attack(enemy);
                        }
                    });
                    break;
            }
        });

        document.addEventListener('keyup', (event: KeyboardEvent) => {
            if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                player.stop();
            }
        });

        function gameLoop(): void {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
            ctx.drawImage(groundImage, 0, canvas.height - 50, canvas.width, 50);
            
            player.update();
            player.draw();
            enemies.forEach(enemy => {
                enemy.update(player);
                enemy.draw();
            });
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
